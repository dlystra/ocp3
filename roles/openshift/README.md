# openshift

Create and destroy a 3x3x3 OpenShift Container Platform in AWS

## Requirements

- AWS account required

## Role Variables

| Variable   | Default | Comments (type)  |
| :---       | :---    | :---             |
| `region` | None       | String - AWS region |
| `env_id` | None | String - The name of the environment, ex. `dev-up-vpc` |
| `vpc_name` | None | String - The AWS VPC name  |
| `ocp_version` | None  | String -  The version of OCP to deploy, ex. `3.11.146` |
| `default_route` | None  | String -  The default route for OCP console, ex. `ocp.levelup-dev.io` |
| `openshift_master_default_subdomain` | None  | String -  The default route for OCP apps, ex. `apps.ocp.levelup-dev.io` |
| `ocp_admin_pw` | None  | String -  The default OCP levelup-admin password for console access via the bootstrap htpasswd identity provider |
| `ocp_client_secret` | None  | String -  The OCP secret, generated by client as unique ID|
| `domain_name` | None  | String -  TLD, ex. `levelup-dev.io` |
| `keycloak_realm_name` | None  | String -  The realm name in Keycloak, ex. `levelup` |
| `s3_bucket_name` | None  | String -  The S3 registry bucket name, ex. `ocp-bucket-dev-up-vpc` |
| `openshift_clusterid` | None  | String -  The cluster identifier for OCP, ex. `cicd-pipeline`, currently dependent on the cluster tag ID in the ec2-instance baseline provisioner.  TBD to make it more dynamic |



## Environment Variables

| Variable   | Default | Comments (type)  |
| :---       | :---    | :---             |
| `ANSIBLE_PRIVATE_KEY_FILE` | None  | String -  (Lookup) The SSH private key file location on the runner |
| `AWS_ACCESS_KEY_ID` | None  | String -  (Lookup) The AWS access key ID for the account |
| `AWS_SECRET_ACCESS_KEY` | None  | String -  (Lookup) The AWS secret for the access key ID  |
| `OCP_MASTERS_CERT_CHAIN` | None  | String -  (Lookup) The actual certificate chain for the masters (not file location)  |
| `OCP_MASTERS_CERT_KEY` | None  | String -  (Lookup) The certificate key for the masters (not file location) |
| `OCP_MASTERS_CERT` | None  | String -  (Lookup) The certificate for the masters (not file location) |
| `OCP_APPS_CERT_CHAIN` | None  | String -  (Lookup) The actual certificate chain for the app routers (not file location)  |
| `OCP_APPS_CERT_KEY` | None  | String -  (Lookup) The certificate key for the app routers (not file location) |
| `OCP_APPS_CERT` | None  | String -  (Lookup) The certificate for the app routers (not file location) |
| `KEYCLOAK_CERT_CHAIN` | None  | String -  (Lookup) The certificate chain for Keycloak (not file location) |

## Dependencies

- Satellite deployed and functional with adequate subs
- IdM and Keycloak deployed and functional

## Example Playbook

See:
- [AWS Infrastructure OpenShift Function common](https://dccscr.dsop.io/levelup-automation/aws-infrastructure/blob/development/environments/shared/group_vars/tag_Function_Openshift.yml)
- [AWS Infrastructure OpenShift Bastion tag](https://dccscr.dsop.io/levelup-automation/aws-infrastructure/blob/development/environments/shared/group_vars/tag_Type_OSE_Bastion.yml)
- [AWS Infrastructure OpenShift Master tag](https://dccscr.dsop.io/levelup-automation/aws-infrastructure/blob/development/environments/shared/group_vars/tag_Type_OSE_Master.yml)
- [AWS Infrastructure OpenShift Infra tag](https://dccscr.dsop.io/levelup-automation/aws-infrastructure/blob/development/environments/shared/group_vars/tag_Type_OSE_Infra.yml)
- [AWS Infrastructure OpenShift App tag](https://dccscr.dsop.io/levelup-automation/aws-infrastructure/blob/development/environments/shared/group_vars/tag_Type_OSE_App.yml)
- [AWS Infrastructure OpenShift Play](https://dccscr.dsop.io/levelup-automation/aws-infrastructure/blob/development/ocp.yml)


## Testing

TBD

## Contributing

Issues, feature requests, ideas are appreciated and can be posted in the Issues section.  Create an issue and generate a Merge Request with a branch to submit changes. 

## License

TBD

## Contributors

- LevelUP